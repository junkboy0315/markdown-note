# Code Complete

[[toc]]

## 変数の使用

### 変数宣言・初期化のベストプラクティス

- 暗黙の宣言は無効にし、すべての変数を明示的に宣言する
- 宣言は使用場所の近くで行う
- 宣言時に初期化も行い、難しい場合はなるべく使用場所の近くで行う
- できるだけ final / const を使う
- カウンタ等、再初期化の必要がないか確認する

### スコープ

- スコープ = 変数の知名度
- 持続間隔 = 変数を利用する箇所の間隔
- 寿命 = 変数を宣言した場所から、最後に利用した場所までの距離

スコープを最小限にすることで下記の効果がある

- 一度に覚える必要のある情報が減り、読みやすくなる
- エラーが入りこむ余地が減る
- リファクタリングしやすくなる

#### スコープを小さくする方法

- 関連するステートメントをまとめる、あるいは別ルーチンに切り出す

```js
// Bad
show(OldData);
show(newData);
delete(oldData);
delete(newData);

// Good
show(OldData);
delete(oldData);

show(newData);
delete(newData);
```

- はじめは最も狭いスコープ（privateなど）にしておく

### 永続性

変数の永続性（賞味期限）を勘違いすると事故が起こる。対策は次の通り。

- 重要な変数に正しい値がセットされているか定期的に確認して、不正なら警告を出す
- 使い終えた変数に意味のない値を設定しておく
- データが永続的でないことを前提にコードを書く（変数はすべて使用直前に宣言する、そうでない変数には警戒する、など）

### バインディングタイム

変数に値を設定する時期のこと。数字が大きいほど柔軟性が高いが、複雑でエラーが起こりやすくなる相反関係にあるため、適当なところで折り合いをつける。

1. ハードコーディング
1. 定数でコーディング(ハードコーディングよりは常にマシ)
1. プログラムのロード時に環境変数などから読み込む
1. インスタンス生成時（ウィンドウ作成時など）
1. ジャストインタイム（ウィンドウ移動時など）

### 1つの目的に1つの変数

- 変数を再利用しない
  - 例えば`temp`を同じスコープで、違う目的で回使わないこと。その場合は、より具体的な2つの名前をつけること。
- 変数に2つの意味や隠れた意味を持たせない（ハイブリッド結合しない）
  - 例えば、通常は人口（Integer）を表すが、-1の場合はエラー(Boolean)を示す変数など。