# シェル・ワンライナー 160 本ノック

Tags: Linux, Shell

## 1.2.a 端末を使う

- `$`マーク - プロンプトという
- `echo $0`のようなもの - コマンド
- シェル - ソフトウェア
  - プロンプトを出したり、コマンドを受け取ったりしている
  - bash はシェルの名前
- 端末 | terminal - 機械
  - 遠くにあるコンピュータと接続して作業するのに使う
  - 元々は本当に機械だった
    - データをコンピュータに送信し、返ってきたデータを印字出力するなど
  - 今はエミュレータ

## 1.2.b コマンドの止め方

- `Ctrl + C` - 強制終了。非常によく使う。
- `Ctrl + D` - 端末にこれ以上ユーザが入力するものがないことを伝える。次点としておぼえておけば OK。

## 1.2.c 計算

```bash
echo '1+1' | bc
```

- `|` - パイプ。左の結果を右に渡す。
- 以下の通り、コマンド関連の用語はあいまいである
  - コマンド
    - 1 単語 - `bc`、`echo` - コマンドとして用いられるソフトウェアのこと
    - 2 単語以上 - `echo $0` - シェルの受け付ける命令のこと
  - ワンライナー - コマンドを 2 つ以上組み合わせたもの
  - パイプライン - パイプにコマンドがつながったもの
  - コマンドライン - 打ち込んだ 1 行分の命令

## 1.2.d ファイルへの保存

```bash
echo '1+1' | bc > result.txt
```

- `>`は、リダイレクト記号という

## 1.2.e ファイルとディレクトリの操作

```bash
echo あいうえお > somefile
mkdir tmp
mv somefile tmp/
# tmpフォルダの内容を一覧
ls -l tmp/
rm tmp/somefile
rmdir tmp/
```

## 1.2.f ファイルのパーミッション

```bash
chmod -r somefile
chmod +r somefile
```

- パーミッション
  - ファイルの所有者
  - ファイルの所有グループ
  - それ以外
- `sudo`を毎回するのが面倒なときは`sudo -s`

## 1.2.g コマンドの調査

man は章立てになっている。たいていは 1 章に求めるものが書いてある。

```bash
man some_command

# 5章を見る
man 5 some_command
```

該当行とその次の１行を出力する

```bash
man ls | grep -A 1 '^  *-a'
```

## 1.3.a sed による置き換え

一回だけ置き換える

```bash
echo あいうえおあいうえお | sed 's/あ/か/'
# かいうえおあいうえお
```

何回も置き換える(`g`)

```bash
echo あいうえおあいうえお | sed 's/あ/か/g'
# かいうえおかいうえお
```

検索対象の文字を使う(`&`)

```bash
echo クロロエチルエーテル | sed 's/エチル/&&/'
# クロロエチルエチルエーテル
```

後方参照(`\1`や`\2`など)

- `-E`は拡張正規表現を有効にするために必要
  - 基本正規表現だけ使えればいいなら不要
  - 無駄にエスケープ文字を入れなくて済むようになる
  - `-r`でも同じ意味

```bash
echo クロロエチルメチルエーテル | sed -E 's/(エチル)(メチル)/\2\1/g'

# 以下のようにもかける
echo クロロエチルメチルエーテル | sed -E 's/(エ..)(...)/\2\1/g'
```

## 1.3.b grep による検索

- `xargs` は出力を横に並べるためのコマンド

```bash
# 0を含むもの
seq 100 | grep "0" | xargs

# 8で始まるもの
seq 100 | grep "^8" | xargs

# 8で終わるもの
seq 100 | grep "8$" | xargs

# 80台
seq 100 | grep "8." | xargs

# 1, 10, 100, ...
seq 100 | grep "^10*$" | xargs

# 偶数
seq 100 | grep "[02468]$" | xargs

# 奇数
seq 100 | grep "[^02468]$" | xargs
```

## 1.3.c grep による検索＆切り出し

- `-o`オプション
  - マッチした部分のみが出力される
  - 複数行で出力される

```bash
# 山田と上田
echo 中村 山田 田代 上田 | grep -o "[^ ]田"
```

- メタ文字とは
  - `&`、`.`、`^`、`$`、`\n`などの特殊な意味を持つ文字

## 1.3.d awk による検索と計算

- grep にプログラム機能を加えたもの。奥が深いよ。
- `awk '/正規表現/'`が`grep '正規表現'` と同じ
- `$1`は「読み込んだ行の１列目の文字列 or 数値」を表す
  - データの n 列目を「第 n フィールド」と呼ぶ事がある
  - `$1`は第 1 フィールドを表す変数と言える
  - 0 スタート**ではない**ので注意
- `print`は自動的に間のスペースと行末の改行を入れてくれる。awk ではよく使う。
- 構成要素
  - パターン - 抽出条件のこと (e.g. `$1%2==0`
  - アクション - 処理のこと。`{}`で囲まれている (e.g. `{print(...)}`
  - ルール - パターンとアクションの組み合わせのこと

```bash
# 正規表現で抜き出す
seq 5 | awk '/[24]/'

# 計算で抜き出す
seq 5 | awk '$1%2==2'

# マッチした行に処理を加える(以下の２つは等価）
seq 5 | awk '$1%2==0{printf("%s 偶数\n", $1)}'
seq 5 | awk '$1%2==0{print($1,"偶数")}'

# 2つ以上のルールを使う
seq 5 | awk '$1%2==0{print($1,"偶数")}$1%2==1{print($1,"奇数")}'
```

- BEGIN パターンは最初の行の処理前に実行される
- END パターンは最終行の処理後に実行される
- 無名のパターンは全ての行で実行される

```bash
seq 5 | awk 'BEGIN{a=0}$1%2==0{print($1,"偶数")}$1%2==1{print($1,"奇数")}{a+=$1}END{print "合計",a}'
```
