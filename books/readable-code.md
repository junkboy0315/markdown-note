# リーダブルコード

[[toc]]

## 表面上の改善

### 理解しやすいコード

- コードは他の人が最短時間で理解できるように書く
- そのためには少しくらい冗長な記載になっても構わない

### 名前に情報を詰め込む

#### 明確な単語を選ぶ

- get => fetch, download
- size => height, numNodes, memoryBytes
- stop => kill, pause(resume できるなら)

#### カラフルな単語を選ぶ

類語辞典を使ってより明確な意味の単語を使う

find => search, extract, locate など

#### 汎用的な名前を避ける

- tmp など
- ループでの i,j,k など

生存期間がごく短いなど、理由があって使うならいいけど、ただの怠慢で上記を使うのはダメ。

#### 抽象的でなく具体的な名前を使う

特定のポートが使えるかチェックする関数なら
serverCanStart() => canListenOnPort()

#### 名前に情報を追加する

```js
// フォーマットを追加する
const id = "af84ef845cd8";
const hexId = "af84ef845cd8";

// 単位を追加する
const size = 10;
const sizeMb = 10;

// 文脈を追加する（セキュリティ被害やバグが出そうな場合）
const url = "http://danger.com";
const untrustedUrl = "http://danger.com";
```

#### 名前の長さ

- スコープが小さければ短い名前でもよい(m など)
- スコープが大きいなら長くて具体的な名前をつける
- 新入りが即座に理解できないような省略形は使わない
  - formatStr はオーケー
  - BEManeger はだめ
- 意味のない単語は削る
  - convertToString => toString
  - doServeLoop => serverLoop

### 誤解されない名前

他の意味と間違えられることはないだろうか？と常に自問せよ

- 適切に名付ける
  - 限界値 --- `max`,`min`
  - 範囲 --- `first`,`last`
  - 包含/排他(最後を含まない) --- `begin`,`end`
    - `end`は包含的でもありうるものの、英語には「ちょうど最後の値を超えたところ」を表現する方法がないのでこれが最善
- まぎらわしい単語を使わない
  - `read`など
- ユーザの期待を裏切らない
  - `getName`などの軽そうな関数に超ヘビーな処理をさせる、など
- 複数の名前を検討して一番いいのを選ぶ

### 美しさ

- 改行位置に一貫性をもたせる
- 多くの長ったらしい関数呼び出しは util 等に切り出して短くする
- コードを段落でまとめてコメントを付ける
- 「正しい」スタイルよりも一貫性を重視する

### コメントするべきことを知る

- コードからすぐ分かることをコメントしない
- ひどい名前はコメントでは救えない、良い名前にしろ
- コードを書いたときに頭にあった「大切な考え」をコメントする
  - 映画監督のコメンタリーのように、なぜそうしたのか、を書く
  - 既知の欠陥にコメントする
  - 定数にコメントする（なぜその値なのか）
- 読み手の立場になる
  - 質問されそうなこと
  - ハマりそうな罠
  - コードの全体像
  - 要約（低レベルコードや、処理のまとまりごとに）

### コメントは正確で簡潔に

- 代名詞（こそあど言葉）を使わない。自明な場合を除き。
- 歯切れ良い文章にする
  - ❌ ステータスによって優先度を変える
  - ⭕ ステータスが 0 のものの優先度を上げる
- 正確に記述する
  - ❌ ファイルの行数を数える
  - ⭕ `\n`の数を数える
- 実例、特にエッジケースをコメントで伝える
  - 例：`Strip("aaba/a/ba", "ab")は"/a/"を返す`
- 低レベルではなく、高レベルの説明をする
  - ❌ list を逆順にイテレートする
  - ⭕ 値段の高い順に表示する
  - 意図が伝わりやすい、間違いに気づきやすい
- 分かりにくい引数には名前付き引数を使う
  - Java など名前付き引数が使えない場合はインラインコメントで
- 情報密度の高い言葉を使う
  - 長くてくどいコメントになってしまったら情報密度の高い言葉がないか探す
  - キャッシュ層、正規化、ヒューリスティック、ブルートフォース、など

## ループとロジックの単純化

複雑なコードは「精神的な荷物」を増やす。「精神的な荷物」が多いコードは、

- 理解しにくい
- バグが見つからない
- 変更しにくい
- 触れるのが楽しくなくなる
